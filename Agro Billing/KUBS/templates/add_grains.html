{% load static tailwind_tags %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KUBS Grains Data Entry</title>
    {% tailwind_css %}
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="w-full max-w-2xl bg-white shadow-xl rounded-2xl p-8">
      <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
        KUBS Grains Data Entry
      </h1>

      <form method="post" class="space-y-5">
        {% csrf_token %}

        <!-- Farmer Info -->
        <div>
          <label class="block text-gray-700 font-medium mb-1"
            >Farmer's Name</label
          >
          <input
            type="text"
            name="farmers_name"
            id="farmers_name"
            class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
            required
          />
        </div>

        <div>
          <label class="block text-gray-700 font-medium mb-1"
            >Contact Number</label
          >
          <input
            type="text"
            name="contact_number"
            id="contact_number"
            class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
            required
          />
        </div>

        <!-- Driver Info -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Driver Name</label
            >
            <input
              type="text"
              name="driver_name"
              id="driver_name"
              class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Driver Contact Number</label
            >
            <input
              type="text"
              name="driver_contact_number"
              id="driver_contact_number"
              class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
            />
          </div>
        </div>

        <div>
          <label class="block text-gray-700 font-medium mb-1"
            >Vehicle Number</label
          >
          <input
            type="text"
            name="vehicle_number"
            id="vehicle_number"
            class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
          />
        </div>

        <!-- Grain Info -->
        <div>
          <label class="block text-gray-700 font-medium mb-1">Grain Type</label>
          {{ form.grain_type }}
        </div>

        <div>
          <label class="block text-gray-700 font-medium mb-1">Buyer Name</label>
          <input
            type="text"
            name="buyer_name"
            id="buyer_name"
            class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
            required
          />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Market Rate</label
            >
            <input
              type="number"
              step="any"
              name="market_rate"
              id="market_rate"
              class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
              required
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Bedding Rate</label
            >
            <input
              type="number"
              step="any"
              name="bedding_rate"
              id="bedding_rate"
              class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
              required
            />
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Weight in Quintals</label
            >
            <input
              type="number"
              step="any"
              name="quantity"
              id="quantity"
              class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
              required
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Advance Amount</label
            >
            <input
              type="number"
              step="any"
              name="advance_amount"
              id="advance_amount"
              class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
              required
            />
          </div>
        </div>

        <!-- Auto-calculated fields -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Total Amount</label
            >
            <input
              type="number"
              step="any"
              name="total_amount"
              id="total_amount"
              class="w-full border-gray-300 rounded-lg shadow-sm p-2 bg-gray-100 text-gray-700"
              readonly
              disabled
            />
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-1"
              >Balance Amount</label
            >
            <input
              type="number"
              step="any"
              name="balance_amount"
              id="balance_amount"
              class="w-full border-gray-300 rounded-lg shadow-sm p-2 bg-gray-100 text-gray-700"
              readonly
              disabled
            />
          </div>
        </div>

        <!-- Date -->
        <div>
          <label class="block text-gray-700 font-medium mb-1"
            >Date of Transaction</label
          >
          <input
            type="date"
            name="date_of_transaction"
            id="date_of_transaction"
            class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 p-2"
          />
        </div>

        <button
          type="submit"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
        >
          Submit
        </button>
      </form>
    </div>

    <script>
      const quantity = document.getElementById("quantity");
      const beddingRate = document.getElementById("bedding_rate");
      const advanceAmount = document.getElementById("advance_amount");
      const totalAmount = document.getElementById("total_amount");
      const balanceAmount = document.getElementById("balance_amount");

      function calculate() {
        const q = parseFloat(quantity.value) || 0;
        const r = parseFloat(beddingRate.value) || 0;
        const a = parseFloat(advanceAmount.value) || 0;

        const total = q * r;
        const balance = total - a;

        totalAmount.value = total.toFixed(2);
        balanceAmount.value = balance.toFixed(2);
      }

      quantity.addEventListener("input", calculate);
      beddingRate.addEventListener("input", calculate);
      advanceAmount.addEventListener("input", calculate);

      document.addEventListener("DOMContentLoaded", () => {
        const dateField = document.getElementById("date_of_transaction");
        if (!dateField.value) {
          // Only set if empty
          const today = new Date().toISOString().split("T")[0]; // Format: YYYY-MM-DD
          dateField.value = today;
        }
      });
    </script>
  </body>
</html>
